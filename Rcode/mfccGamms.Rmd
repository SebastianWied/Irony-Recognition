---
title: "mfccGamms"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, message=FALSE}
require(tidyverse)
require(mgcv)
require(mgcViz)
require(itsadug)
```

Load prepared mfcc data
```{r}

setwd(choose.dir())

mfccData = read.csv("mfcc_ready_for_gamms.csv")

mfccData$speaker = as.factor(mfccData$speaker)
mfccData$label = as.factor(mfccData$label)

```

GAM with tensor product interaction for mfcc
```{r}
m1mfcc=bam(mfcc ~ label + te(time, mfccNum, by=label) + s(time, speaker, bs="fs", m=1) 
           + s(mfccNum, speaker, bs="fs", m=1), data=mfccData)
m1mfccViz = getViz(m1mfcc)
```


```{r}
summary(m1mfcc)
```


```{r, warning=FALSE,message=FALSE,error=FALSE, results='hide',fig.keep=1}
print(plot(m1mfccViz, allTerms=T), pages=3)
```


```{r, warning=FALSE,message=FALSE,error=FALSE, results='hide',fig.keep='all', out.width="80%", out.height="80%"}
par(mfrow=c(1, 2))
plot_diff(m1mfcc, view="mfccNum", shade=TRUE, comp=list(label=c("I", "N")), rm.ranef=TRUE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), rm.ranef=TRUE)

par(mfrow=c(1, 1))
par(mar=c(5, 5, 3, 8))
plot_diff2(m1mfcc, view=c('time', "mfccNum"), comp=list(label=c("I", "N")), 
           main="Difference by label", xlab="Time", ylab="mfccNum", rm.ranef=TRUE)
```

```{r, warning=FALSE,message=FALSE,error=FALSE, results='hide',fig.keep='all', out.width="75%", out.height="75%"}
par(mfrow=c(2, 2))
plot.new
plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=1), 
            col="darkorchid1", main="MFCC1", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=1), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=1), main="MFCC1", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=2), 
            col="darkorchid1", main="MFCC2", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=2), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=2), main="MFCC2", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=3), 
            col="darkorchid1", main="MFCC3", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=3), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=3), main="MFCC3", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=4), 
            col="darkorchid1", main="MFCC4", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=4), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=4), main="MFCC4", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=5), 
            col="darkorchid1", main="MFCC5", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=5), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=5), main="MFCC5", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=6), 
            col="darkorchid1", main="MFCC6", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=6), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=6), main="MFCC6", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=7), 
            col="darkorchid1", main="MFCC7", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=7), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=7), main="MFCC7", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=8), 
            col="darkorchid1", main="MFCC8", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=8), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=8), main="MFCC8", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=9), 
            col="darkorchid1", main="MFCC9", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=9), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=9), main="MFCC9", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=10), 
            col="darkorchid1", main="MFCC10", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=10), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=10), main="MFCC10", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=11), 
            col="darkorchid1", main="MFCC11", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=11), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=11), main="MFCC11", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=12), 
            col="darkorchid1", main="MFCC12", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=12), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=12), main="MFCC12", rm.ranef = FALSE)

plot_smooth(m1mfcc, view="time", cond=list("label"="I", mfccNum=13), 
            col="darkorchid1", main="MFCC13", rm.ranef = FALSE)
plot_smooth(m1mfcc, view="time", cond=list("label"="N", mfccNum=13), 
            col="springgreen3", main="", add=TRUE, rm.ranef = FALSE)
plot_diff(m1mfcc, view="time", shade=TRUE, comp=list(label=c("I", "N")), 
          cond=list(mfccNum=13), main="MFCC13", rm.ranef = FALSE)

```


